"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[675],{1252:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>m,contentTitle:()=>r,default:()=>o,frontMatter:()=>l,metadata:()=>a,toc:()=>h});var a=n(4491),t=n(4848),i=n(8453);const l={},r="\u7ec6\u7a76Batch Norm\u4e0eLayer Norm",m={authorsImageUrls:[]},h=[{value:"\u95ee\u9898\u80cc\u666f\uff1a",id:"\u95ee\u9898\u80cc\u666f",level:3},{value:"Normalization\u516c\u5f0f",id:"normalization\u516c\u5f0f",level:4},{value:"pytorch\u4ee3\u7801\u5c55\u793a",id:"pytorch\u4ee3\u7801\u5c55\u793a",level:3},{value:"\u4e3a\u4ec0\u4e48BN\u9002\u5408CV\uff0cLN\u9002\u5408NLP",id:"\u4e3a\u4ec0\u4e48bn\u9002\u5408cvln\u9002\u5408nlp",level:3}];function c(e){const s={annotation:"annotation",code:"code",h3:"h3",h4:"h4",math:"math",mfrac:"mfrac",mi:"mi",mo:"mo",mrow:"mrow",msqrt:"msqrt",p:"p",path:"path",pre:"pre",semantics:"semantics",span:"span",strong:"strong",svg:"svg",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h3,{id:"\u95ee\u9898\u80cc\u666f",children:"\u95ee\u9898\u80cc\u666f\uff1a"}),"\n",(0,t.jsx)(s.p,{children:"\u7ecf\u5e38\u7528\u5230Batch Norm\u548cLayer Norm\u64cd\u4f5c\uff0c\u4f46\u662f\u5bf9\u4e24\u8005\u7684\u7406\u89e3\u4e5f\u53ea\u505c\u7559\u5728\u65b9\u4fbf\u8bad\u7ec3\u3001LN\u9002\u7528\u4e8eNLP\u3001BN\u9002\u7528\u4e8eCV\u7684\u7a0b\u5ea6\u3002\u4e3a\u4e86\u66f4\u597d\u7406\u89e3\u4e24\u4e2a\u64cd\u4f5c\u7684\u7406\u8bba\u610f\u4e49\uff0c\u8fdb\u884c\u4e86\u4e00\u4e9b\u5b66\u4e60\u3002\u4e0b\u9762\u4e88\u4ee5\u5c55\u5f00\u3002"}),"\n",(0,t.jsx)(s.h4,{id:"normalization\u516c\u5f0f",children:"Normalization\u516c\u5f0f"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"y"}),(0,t.jsx)(s.mo,{children:"="}),(0,t.jsxs)(s.mfrac,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{children:"\u2212"}),(0,t.jsx)(s.mi,{children:"E"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"})]}),(0,t.jsx)(s.msqrt,{children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"V"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"}),(0,t.jsx)(s.mo,{children:"+"}),(0,t.jsx)(s.mi,{children:"\u03f5"})]})})]}),(0,t.jsx)(s.mo,{children:"\u2217"}),(0,t.jsx)(s.mi,{children:"\u03b1"}),(0,t.jsx)(s.mo,{children:"+"}),(0,t.jsx)(s.mi,{children:"\u03b2"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"y=\\frac{x-E[x]}{\\sqrt{Var[x]+\\epsilon}}*\\alpha + \\beta"})]})})}),(0,t.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"="}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1.8396em",verticalAlign:"-0.8296em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,t.jsx)(s.span,{className:"mfrac",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"1.01em"},children:[(0,t.jsxs)(s.span,{style:{top:"-2.4642em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:(0,t.jsx)(s.span,{className:"mord sqrt mtight",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"1.0369em"},children:[(0,t.jsxs)(s.span,{className:"svg-align",style:{top:"-3.4286em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3.4286em"}}),(0,t.jsxs)(s.span,{className:"mord mtight",style:{paddingLeft:"1.19em"},children:[(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"Va"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.02778em"},children:"r"}),(0,t.jsx)(s.span,{className:"mopen mtight",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mclose mtight",children:"]"}),(0,t.jsx)(s.span,{className:"mbin mtight",children:"+"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"\u03f5"})]})]}),(0,t.jsxs)(s.span,{style:{top:"-3.0089em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3.4286em"}}),(0,t.jsx)(s.span,{className:"hide-tail mtight",style:{minWidth:"0.853em",height:"1.5429em"},children:(0,t.jsx)(s.svg,{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.5429em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice",children:(0,t.jsx)(s.path,{d:"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z"})})})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.4197em"},children:(0,t.jsx)(s.span,{})})})]})})})})]}),(0,t.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,t.jsxs)(s.span,{style:{top:"-3.485em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsxs)(s.span,{className:"mord mtight",children:[(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mbin mtight",children:"\u2212"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05764em"},children:"E"}),(0,t.jsx)(s.span,{className:"mopen mtight",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mclose mtight",children:"]"})]})})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.8296em"},children:(0,t.jsx)(s.span,{})})})]})}),(0,t.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"\u2217"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.6667em",verticalAlign:"-0.0833em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(s.span,{className:"mbin",children:"+"}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})]})]})}),"\n",(0,t.jsxs)(s.p,{children:["\u5206\u6bcd\u4e2d\u7684 ",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsx)(s.mrow,{children:(0,t.jsx)(s.mi,{children:"\u03f5"})}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\epsilon"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,t.jsx)(s.span,{className:"mord mathnormal",children:"\u03f5"})]})})]})," \u4f5c\u7528\u662f\u9632\u6b62\u5206\u6bcd\u4e3a0\u3002"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsx)(s.mrow,{children:(0,t.jsxs)(s.mfrac,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{children:"\u2212"}),(0,t.jsx)(s.mi,{children:"E"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"})]}),(0,t.jsx)(s.msqrt,{children:(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{children:"V"}),(0,t.jsx)(s.mi,{children:"a"}),(0,t.jsx)(s.mi,{children:"r"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"["}),(0,t.jsx)(s.mi,{children:"x"}),(0,t.jsx)(s.mo,{stretchy:"false",children:"]"}),(0,t.jsx)(s.mo,{children:"+"}),(0,t.jsx)(s.mi,{children:"\u03f5"})]})})]})}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\frac{x-E[x]}{\\sqrt{Var[x]+\\epsilon}}"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1.8396em",verticalAlign:"-0.8296em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,t.jsx)(s.span,{className:"mfrac",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"1.01em"},children:[(0,t.jsxs)(s.span,{style:{top:"-2.4642em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:(0,t.jsx)(s.span,{className:"mord sqrt mtight",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsxs)(s.span,{className:"vlist",style:{height:"1.0369em"},children:[(0,t.jsxs)(s.span,{className:"svg-align",style:{top:"-3.4286em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3.4286em"}}),(0,t.jsxs)(s.span,{className:"mord mtight",style:{paddingLeft:"1.19em"},children:[(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"Va"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.02778em"},children:"r"}),(0,t.jsx)(s.span,{className:"mopen mtight",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mclose mtight",children:"]"}),(0,t.jsx)(s.span,{className:"mbin mtight",children:"+"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"\u03f5"})]})]}),(0,t.jsxs)(s.span,{style:{top:"-3.0089em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3.4286em"}}),(0,t.jsx)(s.span,{className:"hide-tail mtight",style:{minWidth:"0.853em",height:"1.5429em"},children:(0,t.jsx)(s.svg,{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.5429em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice",children:(0,t.jsx)(s.path,{d:"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z"})})})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.4197em"},children:(0,t.jsx)(s.span,{})})})]})})})})]}),(0,t.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,t.jsxs)(s.span,{style:{top:"-3.485em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsxs)(s.span,{className:"mord mtight",children:[(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mbin mtight",children:"\u2212"}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",style:{marginRight:"0.05764em"},children:"E"}),(0,t.jsx)(s.span,{className:"mopen mtight",children:"["}),(0,t.jsx)(s.span,{className:"mord mathnormal mtight",children:"x"}),(0,t.jsx)(s.span,{className:"mclose mtight",children:"]"})]})})]})]}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.8296em"},children:(0,t.jsx)(s.span,{})})})]})}),(0,t.jsx)(s.span,{className:"mclose nulldelimiter"})]})]})})]}),"\u64cd\u4f5c\u540e\u8fd8\u8981\u8fdb\u884c\u4eff\u5c04\u53d8\u6362(",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mo,{children:"\u2217"}),(0,t.jsx)(s.mi,{children:"\u03b1"}),(0,t.jsx)(s.mo,{separator:"true",children:","}),(0,t.jsx)(s.mo,{children:"+"}),(0,t.jsx)(s.mi,{children:"\u03b2"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"*\\alpha, +\\beta"})]})})}),(0,t.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(s.span,{className:"mord",children:"\u2217"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.0037em"},children:"\u03b1"}),(0,t.jsx)(s.span,{className:"mpunct",children:","}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(s.span,{className:"mord",children:"+"}),(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05278em"},children:"\u03b2"})]})})]}),")\u3002\u539f\u56e0\u662f\uff1a"]}),"\n",(0,t.jsx)(s.p,{children:"Normalization\u901a\u5e38\u5728\u6fc0\u6d3b\u51fd\u6570\u7684\u524d\u4e00\u6b65\u8fdb\u884c\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u4eff\u5c04\u53d8\u6362\uff0c\u5219\u8f93\u51fa\u7684\u6570\u636e\u5747\u503c\u4e3a0\uff0c\u65b9\u5dee\u4e3a1\uff0c\u5728\u8fd9\u4e2a\u53d8\u5316\u8303\u56f4\u5185\u7684\u6fc0\u6d3b\u51fd\u6570\u66f2\u7ebf\u57fa\u672c\u662f\u7ebf\u6027\u7684\uff0c\u62b5\u6d88\u4e86\u6fc0\u6d3b\u51fd\u6570\u5e26\u6765\u7684\u975e\u7ebf\u6027\u4ef7\u503c\u3002"}),"\n",(0,t.jsx)(s.h3,{id:"pytorch\u4ee3\u7801\u5c55\u793a",children:"pytorch\u4ee3\u7801\u5c55\u793a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'class BatchNorm2d(_BatchNorm):\n    r"""Applies Batch Normalization over a 4D input.\n\n    4D is a mini-batch of 2D inputs\n    with additional channel dimension. Method described in the paper\n    `Batch Normalization: Accelerating Deep Network Training by Reducing\n    Internal Covariate Shift <https://arxiv.org/abs/1502.03167>`__ .\n\n    .. math::\n\n        y = \\frac{x - \\mathrm{E}[x]}{ \\sqrt{\\mathrm{Var}[x] + \\epsilon}} * \\gamma + \\beta\n\n    The mean and standard-deviation are calculated per-dimension over\n    the mini-batches and :math:`\\gamma` and :math:`\\beta` are learnable parameter vectors\n    of size `C` (where `C` is the input size). By default, the elements of :math:`\\gamma` are set\n    to 1 and the elements of :math:`\\beta` are set to 0. At train time in the forward pass, the\n    standard-deviation is calculated via the biased estimator, equivalent to\n    ``torch.var(input, unbiased=False)``. However, the value stored in the moving average of the\n    standard-deviation is calculated via the unbiased  estimator, equivalent to\n    ``torch.var(input, unbiased=True)``.\n\n    Also by default, during training this layer keeps running estimates of its\n    computed mean and variance, which are then used for normalization during\n    evaluation. The running estimates are kept with a default :attr:`momentum`\n    of 0.1.\n\n    If :attr:`track_running_stats` is set to ``False``, this layer then does not\n    keep running estimates, and batch statistics are instead used during\n    evaluation time as well.\n\n    .. note::\n        This :attr:`momentum` argument is different from one used in optimizer\n        classes and the conventional notion of momentum. Mathematically, the\n        update rule for running statistics here is\n        :math:`\\hat{x}_\\text{new} = (1 - \\text{momentum}) \\times \\hat{x} + \\text{momentum} \\times x_t`,\n        where :math:`\\hat{x}` is the estimated statistic and :math:`x_t` is the\n        new observed value.\n\n    Because the Batch Normalization is done over the `C` dimension, computing statistics\n    on `(N, H, W)` slices, it\'s common terminology to call this Spatial Batch Normalization.\n\n    Args:\n        num_features: :math:`C` from an expected input of size\n            :math:`(N, C, H, W)`\n        eps: a value added to the denominator for numerical stability.\n            Default: 1e-5\n        momentum: the value used for the running_mean and running_var\n            computation. Can be set to ``None`` for cumulative moving average\n            (i.e. simple average). Default: 0.1\n        affine: a boolean value that when set to ``True``, this module has\n            learnable affine parameters. Default: ``True``\n        track_running_stats: a boolean value that when set to ``True``, this\n            module tracks the running mean and variance, and when set to ``False``,\n            this module does not track such statistics, and initializes statistics\n            buffers :attr:`running_mean` and :attr:`running_var` as ``None``.\n            When these buffers are ``None``, this module always uses batch statistics.\n            in both training and eval modes. Default: ``True``\n\n    Shape:\n        - Input: :math:`(N, C, H, W)`\n        - Output: :math:`(N, C, H, W)` (same shape as input)\n\n    Examples::\n\n        >>> # With Learnable Parameters\n        >>> m = nn.BatchNorm2d(100)\n        >>> # Without Learnable Parameters\n        >>> m = nn.BatchNorm2d(100, affine=False)\n        >>> input = torch.randn(20, 100, 35, 45)\n        >>> output = m(input)\n    """\n\n    def _check_input_dim(self, input):\n        if input.dim() != 4:\n            raise ValueError(f"expected 4D input (got {input.dim()}D input)")\n\nclass BatchNorm2d(\n    num_features: int,\n    eps: float = 0.00001,\n    momentum: float | None = 0.1,\n    affine: bool = True,\n    track_running_stats: bool = True,\n    device: Any | None = None,\n    dtype: Any | None = None\n)\n'})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"batch_norm"}),"\u56fa\u5b9a\u5bf9\u6570\u636e\u7684\u7279\u5f81\u7ef4\u5ea6\u8fdb\u884c\u5f52\u4e00\u5316\u3002"]}),"\n",(0,t.jsx)(s.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,t.jsx)(s.p,{children:"\u8f93\u5165\u6570\u636eshape (2, 3, 4, 4)\uff0c\uff082\u6761\u6570\u636e\uff0c3\u4e2a\u7279\u5f81\u7ef4\u5ea6\uff0c4*4\u5927\u5c0f\uff09\u5bf9\u5176\u8fdb\u884cBatch Norm\uff0c\u5c31\u662f\u5728\u7279\u5f81\u7ef4\u5ea6\u4e0a\u8fdb\u884c\u7684\u3002\u5747\u503c\u7684shape\u4e3a(1, 3, 1, 1)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'class LayerNorm(Module):\n    r"""Applies Layer Normalization over a mini-batch of inputs.\n\n    This layer implements the operation as described in\n    the paper `Layer Normalization <https://arxiv.org/abs/1607.06450>`__\n\n    .. math::\n        y = \\frac{x - \\mathrm{E}[x]}{ \\sqrt{\\mathrm{Var}[x] + \\epsilon}} * \\gamma + \\beta\n\n    The mean and standard-deviation are calculated over the last `D` dimensions, where `D`\n    is the dimension of :attr:`normalized_shape`. For example, if :attr:`normalized_shape`\n    is ``(3, 5)`` (a 2-dimensional shape), the mean and standard-deviation are computed over\n    the last 2 dimensions of the input (i.e. ``input.mean((-2, -1))``).\n    :math:`\\gamma` and :math:`\\beta` are learnable affine transform parameters of\n    :attr:`normalized_shape` if :attr:`elementwise_affine` is ``True``.\n    The variance is calculated via the biased estimator, equivalent to\n    `torch.var(input, unbiased=False)`.\n\n    .. note::\n        Unlike Batch Normalization and Instance Normalization, which applies\n        scalar scale and bias for each entire channel/plane with the\n        :attr:`affine` option, Layer Normalization applies per-element scale and\n        bias with :attr:`elementwise_affine`.\n\n    This layer uses statistics computed from input data in both training and\n    evaluation modes.\n\n    Args:\n        normalized_shape (int or list or torch.Size): input shape from an expected input\n            of size\n\n            .. math::\n                [* \\times \\text{normalized\\_shape}[0] \\times \\text{normalized\\_shape}[1]\n                    \\times \\ldots \\times \\text{normalized\\_shape}[-1]]\n\n            If a single integer is used, it is treated as a singleton list, and this module will\n            normalize over the last dimension which is expected to be of that specific size.\n        eps: a value added to the denominator for numerical stability. Default: 1e-5\n        elementwise_affine: a boolean value that when set to ``True``, this module\n            has learnable per-element affine parameters initialized to ones (for weights)\n            and zeros (for biases). Default: ``True``.\n        bias: If set to ``False``, the layer will not learn an additive bias (only relevant if\n            :attr:`elementwise_affine` is ``True``). Default: ``True``.\n\n    Attributes:\n        weight: the learnable weights of the module of shape\n            :math:`\\text{normalized\\_shape}` when :attr:`elementwise_affine` is set to ``True``.\n            The values are initialized to 1.\n        bias:   the learnable bias of the module of shape\n                :math:`\\text{normalized\\_shape}` when :attr:`elementwise_affine` is set to ``True``.\n                The values are initialized to 0.\n\n    Shape:\n        - Input: :math:`(N, *)`\n        - Output: :math:`(N, *)` (same shape as input)\n\n    Examples::\n\n        >>> # NLP Example\n        >>> batch, sentence_length, embedding_dim = 20, 5, 10\n        >>> embedding = torch.randn(batch, sentence_length, embedding_dim)\n        >>> layer_norm = nn.LayerNorm(embedding_dim)\n        >>> # Activate module\n        >>> layer_norm(embedding)\n        >>>\n        >>> # Image Example\n        >>> N, C, H, W = 20, 5, 10, 10\n        >>> input = torch.randn(N, C, H, W)\n        >>> # Normalize over the last three dimensions (i.e. the channel and spatial dimensions)\n        >>> # as shown in the image below\n        >>> layer_norm = nn.LayerNorm([C, H, W])\n        >>> output = layer_norm(input)\n\n    .. image:: ../_static/img/nn/layer_norm.jpg\n        :scale: 50 %\n\n    """\n\n    __constants__ = ["normalized_shape", "eps", "elementwise_affine"]\n    normalized_shape: tuple[int, ...]\n    eps: float\n    elementwise_affine: bool\n\n    def __init__(\n        self,\n        normalized_shape: _shape_t,\n        eps: float = 1e-5,\n        elementwise_affine: bool = True,\n        bias: bool = True,\n        device=None,\n        dtype=None,\n    ) -> None:\n        factory_kwargs = {"device": device, "dtype": dtype}\n        super().__init__()\n        if isinstance(normalized_shape, numbers.Integral):\n            # mypy error: incompatible types in assignment\n            normalized_shape = (normalized_shape,)  # type: ignore[assignment]\n        self.normalized_shape = tuple(normalized_shape)  # type: ignore[arg-type]\n        self.eps = eps\n        self.elementwise_affine = elementwise_affine\n        if self.elementwise_affine:\n            self.weight = Parameter(\n                torch.empty(self.normalized_shape, **factory_kwargs)\n            )\n            if bias:\n                self.bias = Parameter(\n                    torch.empty(self.normalized_shape, **factory_kwargs)\n                )\n            else:\n                self.register_parameter("bias", None)\n        else:\n            self.register_parameter("weight", None)\n            self.register_parameter("bias", None)\n\n        self.reset_parameters()\n\n    def reset_parameters(self) -> None:\n        if self.elementwise_affine:\n            init.ones_(self.weight)\n            if self.bias is not None:\n                init.zeros_(self.bias)\n\n    def forward(self, input: Tensor) -> Tensor:\n        return F.layer_norm(\n            input, self.normalized_shape, self.weight, self.bias, self.eps\n        )\n\n    def extra_repr(self) -> str:\n        return (\n            "{normalized_shape}, eps={eps}, "\n            "elementwise_affine={elementwise_affine}".format(**self.__dict__)\n        )\n\nclass LayerNorm(\n    normalized_shape: _shape_t,\n    eps: float = 0.00001,\n    elementwise_affine: bool = True,\n    bias: bool = True,\n    device: Any | None = None,\n    dtype: Any | None = None\n)\n'})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"layer_norm"}),"\u63d0\u4f9b\u7684",(0,t.jsx)(s.code,{children:"normalized_shape"}),"\u7528\u4ee5\u6307\u5b9a\u672b\u5c3e\u82e5\u5e72\u7ef4\u5ea6\uff0c\u4e00\u822c\u800c\u8a00\u5bf9\u4e00\u6761\u6570\u636e\u4e2d\u7684\u4e00\u4e2atoken\u7684\u6240\u6709\u7279\u5f81\u8fdb\u884c\u5f52\u4e00\u5316\u3002"]}),"\n",(0,t.jsx)(s.p,{children:"\u4e3e\u4f8b\uff1a"}),"\n",(0,t.jsx)(s.p,{children:"\u8f93\u5165\u6570\u636eshape (2, 5, 5)\uff0c\uff082\u6761\u6570\u636e\uff0c\u6bcf\u67615\u4e2atoken\uff0c\u7279\u5f81\u7ef4\u5ea6\u4e3a5\uff09\u5bf9\u5176\u5728\u6700\u540e\u4e00\u4e2a\u7ef4\u5ea6\u4e0a\u8fdb\u884cLayer Norm\uff0c\u5219\u5747\u503c\u7684shape\u4e3a(2, 5, 1)"}),"\n",(0,t.jsx)(s.h3,{id:"\u4e3a\u4ec0\u4e48bn\u9002\u5408cvln\u9002\u5408nlp",children:"\u4e3a\u4ec0\u4e48BN\u9002\u5408CV\uff0cLN\u9002\u5408NLP"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"BN"}),"\u5728 ",(0,t.jsx)(s.strong,{children:"batch"})," \u7ef4\u5ea6\u4e0a\u8ba1\u7b97\u7edf\u8ba1\u91cf\uff0c\u5bf9\u4e8e\u4e0d\u540c\u6837\u672c\u7684\u540c\u4e00\u7279\u5f81\u8fdb\u884c\u5f52\u4e00\u5316\uff0c",(0,t.jsx)(s.strong,{children:"LN"}),"\u5728",(0,t.jsx)(s.strong,{children:"\u7279\u5f81"}),"\u7ef4\u5ea6\u4e0a\u8ba1\u7b97\u7edf\u8ba1\u91cf\uff0c\u5bf9\u4e8e\u540c\u4e00\u6837\u672c\u5185\u7684\u4e0d\u540c\u7279\u5f81\u503c\u8fdb\u884c\u5f52\u4e00\u5316\u3002"]}),"\n",(0,t.jsx)(s.p,{children:"\u6709\u4e86\u4ee5\u4e0a\u7684\u57fa\u7840\u4fe1\u606f\uff0c\u518d\u6765\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n",(0,t.jsxs)(s.p,{children:["\u5bf9\u4e8e\u56fe\u50cf\u6570\u636e\uff0c\u5176\u7a7a\u95f4\u4e0d\u53d8\u6027\uff08\u540c\u4e00\u7269\u4f53\u5728\u4e0d\u540c\u4f4d\u7f6e\u5177\u6709\u76f8\u4f3c\u7684\u7279\u5f81\u54cd\u5e94\uff09\u4f7f\u5f97\u5176\u5e0c\u671b",(0,t.jsx)(s.strong,{children:"\u4e0d\u540c\u56fe\u50cf\u4e2d\u76f8\u540c\u8bed\u4e49\u7684\u7279\u5f81\u5728\u6570\u503c\u5206\u5e03\u4e0a\u4fdd\u6301\u4e00\u81f4"}),"\u3002\u4e14\u56fe\u50cf\u6570\u636e\u7684\u683c\u5f0f\u5c5e\u6027\uff08\u56fe\u7247\u5927\u5c0f\u65b9\u4fbf\u5bf9\u9f50\uff09\u4f7f\u5f97BN\u64cd\u4f5c\u5bb9\u6613\u8fdb\u884c\u3002"]}),"\n",(0,t.jsxs)(s.p,{children:["\u5bf9\u4e8e\u6587\u672c\u6570\u636e\uff0c\u5176\u4f4d\u7f6e\u654f\u611f\u6027\uff08",(0,t.jsx)(s.strong,{children:"\u76f8\u540c\u5b57\u6bb5\u5728\u4e0d\u540c\u53e5\u5b50\u4e2d\u7684\u4e0d\u540c\u4f4d\u7f6e\u53ef\u80fd\u8868\u8fbe\u4e0d\u540c\u7684\u8bed\u4e49"}),"\uff09\u5bfc\u81f4BN\u64cd\u4f5c\u4e0d\u9002\u5408\u6587\u672c\u6570\u636e\uff0c\u5f3a\u884c\u5f15\u5165BN\u53ef\u80fd\u5bfc\u81f4\u6587\u672c\u7684\u4f4d\u7f6e\u4fe1\u606f\u5931\u6548\uff0c\u4e14\u6587\u672c\u7684\u683c\u5f0f\u5c5e\u6027\uff08\u4e00\u822c\u90fd\u662f\u53d8\u957f\u6570\u636e\uff09\u4e5f\u4e0d\u65b9\u4fbf\u8fdb\u884cBN\u64cd\u4f5c\u3002\u800cLN\u65e2\u4fdd\u6301\u4e86\u5f52\u4e00\u5316\u64cd\u4f5c\u5e26\u6765\u7684\u6570\u503c\u7a33\u5b9a\u3001\u5229\u4e8e\u8bad\u7ec3\u7684benefit\uff0c\u53c8\u4fdd\u6301\u4e86\u53e5\u5b50\u5185\u90e8\u7279\u5f81\u5206\u5e03\u7684\u72ec\u7acb\u6027\uff0c\u4e14\u9002\u5408\u53d8\u957f\u6570\u636e\u3002"]})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},4491:e=>{e.exports=JSON.parse('{"permalink":"/blog/2025/11/19/welcome/BN_LN","editUrl":"https://github.com/zhangyan-didu/zhangyan-didu.github.io/tree/main/blog/2025-11-19-welcome/BN_LN.md","source":"@site/blog/2025-11-19-welcome/BN_LN.md","title":"\u7ec6\u7a76Batch Norm\u4e0eLayer Norm","description":"\u95ee\u9898\u80cc\u666f\uff1a","date":"2025-11-19T00:00:00.000Z","tags":[],"readingTime":7.75,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"nextItem":{"title":"DPO\u7b97\u6cd5\u8be6\u89e3","permalink":"/blog/2025/11/19/welcome/DPO"}}')},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>r});var a=n(6540);const t={},i=a.createContext(t);function l(e){const s=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);